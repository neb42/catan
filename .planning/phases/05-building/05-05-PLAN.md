---
phase: 05-building
plan: 05
type: execute
wave: 4
depends_on: ['05-04']
files_modified: []
autonomous: false

must_haves:
  truths:
    - 'User can build roads by spending resources'
    - 'User can build settlements by spending resources'
    - 'User can upgrade settlements to cities by spending resources'
    - 'Game validates placement rules and prevents invalid builds'
    - 'All players see builds in real-time'
  artifacts: []
  key_links: []
---

<objective>
Human verification of the complete building system.

Purpose: Confirm building works end-to-end with correct validation, resource deduction, and real-time sync.
Output: Verified Phase 5 building system.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-building/05-CONTEXT.md
@.planning/phases/05-building/05-04-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Verify complete building system</name>
  <what-built>
Complete building system with:
- BuildControls UI with Road/Settlement/City buttons
- Cost tooltips on buttons
- Remaining piece counts displayed
- Valid location highlighting in build mode
- WebSocket-based build requests and responses
- Resource deduction on successful builds
- Real-time sync across all players
  </what-built>
  <how-to-verify>
**Setup (in two browser tabs):**
1. Start servers: `npx nx serve api` and `npx nx serve web`
2. Open http://localhost:4200 in Tab 1, create room, enter nickname
3. Open http://localhost:4200 in Tab 2, join same room, enter nickname
4. Mark both players ready, complete initial placement phase (snake draft)
5. Roll dice in Tab 1 to enter main phase

**Test BUILD-01 (Road building):**

1. In Tab 1, verify Road button shows remaining count (should be 13 after 2 setup roads)
2. Hover Road button - verify tooltip shows cost (1 wood, 1 brick icons)
3. If player doesn't have resources, verify button is disabled with reason tooltip
4. Give player resources via multiple dice rolls until they have 1 wood + 1 brick
5. Click Road button - verify valid edges highlight (matching Phase 3 style)
6. Click valid edge - verify road appears, resources deducted, toast shows
7. In Tab 2 - verify road appears immediately (real-time sync)

**Test BUILD-02 (Settlement building):**

1. Get 1 wood + 1 brick + 1 sheep + 1 wheat (may need multiple turns)
2. Click Settlement button - verify valid vertices highlight
3. Verify only locations that are 2 away from existing AND adjacent to own road highlight
4. Click valid vertex - verify settlement appears, resources deducted

**Test BUILD-03 (City upgrade):**

1. Get 3 ore + 2 wheat (may need multiple turns/players)
2. Click City button - verify only own settlements highlight (not cities)
3. Click own settlement - verify it becomes a city (different visual)
4. Verify resources deducted correctly

**Test BUILD-05/06/07/08 (Validation):**

1. Try to build settlement not adjacent to own road - should not be possible (location not highlighted)
2. Try to build road not connected to network - should not be possible
3. Try to build on occupied location - should not be possible
4. Try to build without resources - button should be disabled with tooltip explanation

**Test piece limits:**

1. Verify remaining count updates after each build
2. Note: Cannot fully test limits in single game, but counts should update correctly

**Expected behavior:**

- Buttons disabled when can't afford, no valid locations, or not your turn
- Valid locations match Phase 3 visual style
- Single placement per click (mode exits after building)
- Cancel button works to exit build mode
- Other player sees all builds in real-time
  </how-to-verify>
  <resume-signal>Type "approved" if building system works correctly, or describe issues found</resume-signal>
  </task>

</tasks>

<verification>
Human verification covers all BUILD-01 through BUILD-08 requirements.
</verification>

<success_criteria>

- Road building works: click button, click edge, road appears, resources deducted
- Settlement building works: click button, click vertex (2 away + adjacent to road), settlement appears
- City upgrade works: click button, click own settlement, becomes city
- Validation prevents invalid placements (buttons disabled or locations not highlighted)
- Real-time sync: other players see builds immediately
- Cost tooltips show correct resource costs
- Remaining piece counts update correctly
  </success_criteria>

<output>
After completion, create `.planning/phases/05-building/05-05-SUMMARY.md`
</output>
