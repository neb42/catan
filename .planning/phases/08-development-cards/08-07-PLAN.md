---
phase: 08-development-cards
plan: 07
type: execute
wave: 4
depends_on: ['08-04', '08-05', '08-06']
files_modified:
  - apps/web/src/components/DevCard/DevCardHand.tsx
  - apps/web/src/components/DevCard/DevCardButton.tsx
  - apps/web/src/components/DevCard/BuyDevCardButton.tsx
  - apps/web/src/components/Game/BuildControls.tsx
  - apps/web/src/components/Game/GamePlayerList.tsx
  - apps/web/src/components/Game/Game.tsx
autonomous: true

must_haves:
  truths:
    - 'Player can see their dev cards in hand'
    - 'Unplayable cards are grayed out with tooltip explaining why'
    - 'Buy Dev Card button shows deck count and validates affordability'
    - 'VP cards have distinct visual treatment (secret)'
    - 'Opponent dev card counts are visible'
  artifacts:
    - path: 'apps/web/src/components/DevCard/DevCardHand.tsx'
      provides: 'Dev card hand display integrated with resource hand'
      contains: 'DevCardHand'
    - path: 'apps/web/src/components/DevCard/BuyDevCardButton.tsx'
      provides: 'Button to purchase dev cards with deck count'
      contains: 'BuyDevCardButton'
  key_links:
    - from: 'apps/web/src/components/DevCard/DevCardButton.tsx'
      to: 'useCanPlayCard hook'
      via: 'determines card playability'
      pattern: 'useCanPlayCard'
    - from: 'apps/web/src/components/Game/GamePlayerList.tsx'
      to: 'gameStore opponentDevCardCounts'
      via: 'displays card count badge'
      pattern: 'opponentDevCardCounts'
---

<objective>
Build dev card UI components: hand display, buy button, and player list integration.

Purpose: Complete the user-facing dev card experience
Output: DevCardHand component, BuyDevCardButton, opponent card count display
</objective>

<execution_context>
@/Users/bmcalindin/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bmcalindin/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-development-cards/08-04-SUMMARY.md
@.planning/phases/08-development-cards/08-05-SUMMARY.md
@.planning/phases/08-development-cards/08-06-SUMMARY.md
@.planning/phases/08-development-cards/08-CONTEXT.md

@apps/web/src/components/Game/ResourceHand.tsx
@apps/web/src/components/Game/BuildControls.tsx
@apps/web/src/components/Game/GamePlayerList.tsx
@apps/web/src/hooks/useDevCardState.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DevCardButton and DevCardHand components</name>
  <files>apps/web/src/components/DevCard/DevCardButton.tsx, apps/web/src/components/DevCard/DevCardHand.tsx</files>
  <action>
Create the dev card display components.

**Create apps/web/src/components/DevCard/DevCardButton.tsx:**

```tsx
import { Button, Tooltip, Box } from '@mantine/core';
import { DevelopmentCardType, OwnedDevCard } from '@catan/shared';
import { useGameStore } from '../../stores/gameStore';

interface DevCardButtonProps {
  card: OwnedDevCard;
}

// Card display names and icons
const CARD_INFO: Record<
  DevelopmentCardType,
  { name: string; icon: string; color: string }
> = {
  knight: { name: 'Knight', icon: '‚öîÔ∏è', color: '#8B4513' },
  victory_point: { name: 'Victory Point', icon: '‚≠ê', color: '#FFD700' },
  road_building: { name: 'Road Building', icon: 'üõ§Ô∏è', color: '#654321' },
  year_of_plenty: { name: 'Year of Plenty', icon: 'üåæ', color: '#228B22' },
  monopoly: { name: 'Monopoly', icon: 'üí∞', color: '#4169E1' },
};

export function DevCardButton({ card }: DevCardButtonProps) {
  const myId = useGameStore((s) => s.myPlayerId);
  const turnCurrentPlayerId = useGameStore((s) => s.turnCurrentPlayerId);
  const turnPhase = useGameStore((s) => s.turnPhase);
  const turnNumber = useGameStore((s) => s.turnNumber);
  const hasPlayedDevCardThisTurn = useGameStore(
    (s) => s.hasPlayedDevCardThisTurn,
  );
  const sendMessage = useGameStore((s) => s.sendMessage);

  const info = CARD_INFO[card.type];

  // Check if card can be played
  let canPlay = true;
  let disabledReason = '';

  // VP cards are never "played"
  if (card.type === 'victory_point') {
    canPlay = false;
    disabledReason = 'Victory Point cards score automatically';
  } else {
    // Must be our turn
    if (turnCurrentPlayerId !== myId) {
      canPlay = false;
      disabledReason = 'Not your turn';
    }
    // Knight can be played before/after roll, others need main phase
    else if (card.type !== 'knight' && turnPhase !== 'main') {
      canPlay = false;
      disabledReason = 'Must roll dice first';
    }
    // Can't play same turn purchased
    else if (card.purchasedOnTurn === turnNumber) {
      canPlay = false;
      disabledReason = 'Cannot play card purchased this turn';
    }
    // One dev card per turn
    else if (hasPlayedDevCardThisTurn) {
      canPlay = false;
      disabledReason = 'Already played a dev card this turn';
    }
  }

  const handleClick = () => {
    if (!canPlay) return;
    sendMessage({
      type: 'play_dev_card',
      cardId: card.id,
    });
  };

  const buttonContent = (
    <Button
      variant={card.type === 'victory_point' ? 'light' : 'filled'}
      color={info.color}
      disabled={!canPlay}
      onClick={handleClick}
      style={{
        opacity: canPlay ? 1 : 0.5,
        minWidth: 80,
        height: 100,
        flexDirection: 'column',
        gap: 4,
      }}
    >
      <Box style={{ fontSize: 28 }}>{info.icon}</Box>
      <Box style={{ fontSize: 12, textAlign: 'center' }}>{info.name}</Box>
    </Button>
  );

  if (!canPlay && disabledReason) {
    return (
      <Tooltip label={disabledReason} position="top">
        {buttonContent}
      </Tooltip>
    );
  }

  return buttonContent;
}
```

**Create apps/web/src/components/DevCard/DevCardHand.tsx:**

```tsx
import { Group, Text, Box } from '@mantine/core';
import { useGameStore } from '../../stores/gameStore';
import { DevCardButton } from './DevCardButton';

export function DevCardHand() {
  const myDevCards = useGameStore((s) => s.myDevCards);

  if (myDevCards.length === 0) {
    return null;
  }

  // Separate VP cards for distinct display
  const vpCards = myDevCards.filter((c) => c.type === 'victory_point');
  const playableCards = myDevCards.filter((c) => c.type !== 'victory_point');

  return (
    <Box style={{ marginTop: 16 }}>
      <Text size="sm" fw={500} mb={8}>
        Development Cards
      </Text>
      <Group gap="sm">
        {playableCards.map((card) => (
          <DevCardButton key={card.id} card={card} />
        ))}

        {vpCards.length > 0 && (
          <Box
            style={{
              borderLeft: '2px solid gold',
              paddingLeft: 12,
              display: 'flex',
              gap: 8,
            }}
          >
            {vpCards.map((card) => (
              <DevCardButton key={card.id} card={card} />
            ))}
          </Box>
        )}
      </Group>
    </Box>
  );
}
```

Create the directory if needed:

```bash
mkdir -p apps/web/src/components/DevCard
```

  </action>
  <verify>Run `npx nx build web` - should compile without errors</verify>
  <done>DevCardButton shows card with playability check and tooltip, DevCardHand displays all owned cards</done>
</task>

<task type="auto">
  <name>Task 2: Create BuyDevCardButton and integrate with BuildControls</name>
  <files>apps/web/src/components/DevCard/BuyDevCardButton.tsx, apps/web/src/components/Game/BuildControls.tsx</files>
  <action>
**Create apps/web/src/components/DevCard/BuyDevCardButton.tsx:**
```tsx
import { Button, Tooltip, Badge, Group } from '@mantine/core';
import { useCanBuyDevCard, useDeckRemaining } from '../../hooks/useDevCardState';
import { useGameStore } from '../../stores/gameStore';

export function BuyDevCardButton() {
const { canBuy, reason } = useCanBuyDevCard();
const deckRemaining = useDeckRemaining();
const sendMessage = useGameStore((s) => s.sendMessage);

const handleBuy = () => {
if (!canBuy) return;
sendMessage({ type: 'buy_dev_card' });
};

const button = (
<Button
      onClick={handleBuy}
      disabled={!canBuy}
      variant="outline"
      color="violet"
    >
<Group gap="xs">
<span>Buy Dev Card</span>
<Badge size="sm" variant="filled" color="violet">
{deckRemaining}
</Badge>
</Group>
</Button>
);

if (!canBuy && reason) {
return (
<Tooltip label={reason} position="top">
{button}
</Tooltip>
);
}

return button;
}

````

**Update apps/web/src/components/Game/BuildControls.tsx:**
Add the BuyDevCardButton alongside existing build buttons.

Find the BuildControls component and add:
1. Import: `import { BuyDevCardButton } from '../DevCard/BuyDevCardButton';`
2. Add `<BuyDevCardButton />` in the controls group, after the City button:

```tsx
// In the return, add after the build buttons:
<BuyDevCardButton />
````

Position it logically with the other action buttons. It should appear when:

- Player is in main game phase (not setup)
- It's the player's turn (handled internally by hook)
  </action>
  <verify>Run `npx nx build web` - should compile without errors</verify>
  <done>BuyDevCardButton shows deck count, disabled state with reason, integrated into BuildControls</done>
  </task>

<task type="auto">
  <name>Task 3: Add opponent dev card counts and knight counts to GamePlayerList</name>
  <files>apps/web/src/components/Game/GamePlayerList.tsx, apps/web/src/components/Game/Game.tsx</files>
  <action>
**Update apps/web/src/components/Game/GamePlayerList.tsx:**
Add dev card count and knight count badges to each player's display.

Find where player info is rendered and add:

```tsx
// Import hooks
import { useGameStore } from '../../stores/gameStore';

// Inside the player rendering, get counts
const opponentDevCardCounts = useGameStore((s) => s.opponentDevCardCounts);
const knightsPlayed = useGameStore((s) => s.knightsPlayed);
const myDevCards = useGameStore((s) => s.myDevCards);
const myPlayerId = useGameStore((s) => s.myPlayerId);

// For each player, show:
// - Dev card count (for opponents: from opponentDevCardCounts, for self: myDevCards.length)
// - Knights played count (for Largest Army tracking)

// Example badge additions in player row:
<Group gap="xs">
  {/* Dev card count */}
  <Tooltip label="Development cards">
    <Badge size="sm" color="violet">
      üìú{' '}
      {player.id === myPlayerId
        ? myDevCards.length
        : opponentDevCardCounts[player.id] || 0}
    </Badge>
  </Tooltip>

  {/* Knights played */}
  {(knightsPlayed[player.id] || 0) > 0 && (
    <Tooltip label="Knights played">
      <Badge size="sm" color="brown">
        ‚öîÔ∏è {knightsPlayed[player.id]}
      </Badge>
    </Tooltip>
  )}
</Group>;
```

**Update apps/web/src/components/Game/Game.tsx:**
Integrate the DevCardHand component into the game layout.

1. Import: `import { DevCardHand } from '../DevCard/DevCardHand';`
2. Import: `import { ResourcePickerModal } from '../CardPlay/ResourcePickerModal';`
3. Import: `import { MonopolyModal } from '../CardPlay/MonopolyModal';`
4. Import: `import { RoadBuildingOverlay } from '../CardPlay/RoadBuildingOverlay';`

5. Add DevCardHand near ResourceHand (below or integrated):

```tsx
<ResourceHand />
<DevCardHand />
```

6. Add modal components (render always, they control their own visibility):

```tsx
<ResourcePickerModal />
<MonopolyModal />
<RoadBuildingOverlay />
```

  </action>
  <verify>Run `npx nx build web` - should compile without errors</verify>
  <done>GamePlayerList shows dev card counts and knight counts, Game.tsx renders DevCardHand and card play modals</done>
</task>

</tasks>

<verification>
1. `npx nx build web` passes
2. Dev cards display in hand with correct icons and names
3. Unplayable cards are grayed with tooltip
4. VP cards have distinct gold border/styling
5. Buy Dev Card button shows deck count
6. Opponent card counts visible in player list
7. Knight counts visible for Largest Army tracking
</verification>

<success_criteria>

- DevCardButton shows playability state with Tooltip for disabled reason
- VP cards visually distinct (gold/star styling, never playable)
- BuyDevCardButton shows deck remaining count
- GamePlayerList shows üìú badge with dev card count per player
- GamePlayerList shows ‚öîÔ∏è badge with knight count when > 0
- DevCardHand integrates into game layout near ResourceHand
- All modals (ResourcePicker, Monopoly, RoadBuilding) render in Game.tsx
  </success_criteria>

<output>
After completion, create `.planning/phases/08-development-cards/08-07-SUMMARY.md`
</output>
