---
phase: 07-robber
plan: 06
type: execute
wave: 2
depends_on: []
files_modified:
  - apps/web/src/main.tsx
  - apps/web/src/components/Feedback/GameLog.tsx
  - apps/web/src/components/Feedback/useGameNotifications.ts
  - apps/web/src/stores/gameStore.ts
  - apps/web/src/components/Game.tsx
autonomous: true

must_haves:
  truths:
    - 'User sees toast notifications for game actions'
    - 'User can view scrollable game log'
    - 'Error messages display clearly'
  artifacts:
    - path: 'apps/web/src/components/Feedback/GameLog.tsx'
      provides: 'Collapsible game log panel'
      exports: ['GameLog']
    - path: 'apps/web/src/components/Feedback/useGameNotifications.ts'
      provides: 'Toast notification helper'
      exports: ['showGameNotification', 'useGameNotifications']
  key_links:
    - from: 'apps/web/src/main.tsx'
      to: '@mantine/notifications'
      via: 'Notifications provider'
      pattern: 'Notifications'
---

<objective>
Implement action feedback system with toast notifications and game log.

Purpose: Addresses UX-02 (feedback confirmation for all actions) and UX-03 (error messages for invalid actions). Provides transparency about game state changes and helps players understand what's happening.

Output: Notifications provider setup, GameLog component, notification helper hook.
</objective>

<execution_context>
@/Users/bmcalindin/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bmcalindin/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-robber/07-CONTEXT.md
@.planning/phases/07-robber/07-RESEARCH.md

@apps/web/src/main.tsx
@apps/web/src/components/Game.tsx
@apps/web/src/stores/gameStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Mantine Notifications provider to app</name>
  <files>apps/web/src/main.tsx</files>
  <action>
Add Mantine Notifications to the app entry point:

1. Import Notifications component and styles:

```typescript
import { Notifications } from '@mantine/notifications';
import '@mantine/notifications/styles.css';
```

2. Add Notifications component inside MantineProvider but after any other wrappers:

```tsx
<MantineProvider>
  <Notifications position="bottom-center" autoClose={3000} />
  {/* Rest of app */}
</MantineProvider>
```

Position at bottom-center per CONTEXT.md decision. Auto-close after 3 seconds.
</action>
<verify>
Run: `npx nx serve web` and verify no console errors on startup.
</verify>
<done>
Mantine Notifications provider configured at bottom-center with 3s auto-close.
</done>
</task>

<task type="auto">
  <name>Task 2: Add game log state and create notification helper</name>
  <files>
    apps/web/src/stores/gameStore.ts
    apps/web/src/components/Feedback/useGameNotifications.ts
  </files>
  <action>
**1. Add game log state to gameStore:**
```typescript
// In store interface
interface GameLogEntry {
  id: string;
  message: string;
  type: 'info' | 'success' | 'warning' | 'error';
  timestamp: Date;
}

// Add to state
gameLog: [] as GameLogEntry[],

// Add action
addLogEntry: (message: string, type: 'info' | 'success' | 'warning' | 'error' = 'info') => set((state) => ({
gameLog: [
...state.gameLog.slice(-99), // Keep last 100 entries
{
id: `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
message,
type,
timestamp: new Date(),
},
],
})),

clearGameLog: () => set({ gameLog: [] }),

````

**2. Add selector hook:**
```typescript
export const useGameLog = () => useGameStore((state) => state.gameLog);
````

**3. Create apps/web/src/components/Feedback/useGameNotifications.ts:**

```typescript
import { notifications } from '@mantine/notifications';
import { useGameStore } from '@web/stores/gameStore';

type NotificationType = 'info' | 'success' | 'warning' | 'error';

const TYPE_COLORS: Record<NotificationType, string> = {
  info: 'blue',
  success: 'green',
  warning: 'yellow',
  error: 'red',
};

/**
 * Show a game notification (toast + log entry)
 */
export function showGameNotification(
  message: string,
  type: NotificationType = 'info',
) {
  // Show toast
  notifications.show({
    message,
    color: TYPE_COLORS[type],
    autoClose: 3000,
    withCloseButton: true,
  });

  // Add to game log
  useGameStore.getState().addLogEntry(message, type);
}

/**
 * Hook that provides notification functions for use in components
 */
export function useGameNotifications() {
  const addLogEntry = useGameStore((s) => s.addLogEntry);

  const notify = (message: string, type: NotificationType = 'info') => {
    notifications.show({
      message,
      color: TYPE_COLORS[type],
      autoClose: 3000,
      withCloseButton: true,
    });
    addLogEntry(message, type);
  };

  return {
    info: (message: string) => notify(message, 'info'),
    success: (message: string) => notify(message, 'success'),
    warning: (message: string) => notify(message, 'warning'),
    error: (message: string) => notify(message, 'error'),
  };
}
```

**4. Create index.ts:**

```typescript
// apps/web/src/components/Feedback/index.ts
export { GameLog } from './GameLog';
export {
  showGameNotification,
  useGameNotifications,
} from './useGameNotifications';
```

  </action>
  <verify>
Run: `npx tsc --noEmit -p apps/web/tsconfig.json`
Store and notification helper compile.
  </verify>
  <done>
gameStore has gameLog state, notification helper shows toasts and logs entries.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create collapsible GameLog component</name>
  <files>apps/web/src/components/Feedback/GameLog.tsx</files>
  <action>
Create the GameLog component with collapsible panel:

```tsx
import { useState } from 'react';
import {
  Paper,
  Text,
  Stack,
  Group,
  ActionIcon,
  ScrollArea,
  Badge,
} from '@mantine/core';
import { IconChevronUp, IconChevronDown } from '@tabler/icons-react';
import { useGameLog } from '@web/stores/gameStore';

const TYPE_COLORS = {
  info: 'blue',
  success: 'green',
  warning: 'yellow',
  error: 'red',
} as const;

export function GameLog() {
  const [expanded, setExpanded] = useState(false);
  const entries = useGameLog();

  const recentEntries = entries.slice(-50).reverse(); // Most recent first

  return (
    <Paper
      withBorder
      p="xs"
      style={{
        position: 'fixed',
        bottom: 60, // Above notifications
        right: 16,
        width: 300,
        maxHeight: expanded ? 400 : 48,
        overflow: 'hidden',
        transition: 'max-height 0.2s ease',
        zIndex: 100,
      }}
    >
      <Group justify="space-between" mb={expanded ? 'xs' : 0}>
        <Group gap="xs">
          <Text size="sm" fw={500}>
            Game Log
          </Text>
          <Badge size="xs" variant="light">
            {entries.length}
          </Badge>
        </Group>
        <ActionIcon
          variant="subtle"
          size="sm"
          onClick={() => setExpanded(!expanded)}
        >
          {expanded ? (
            <IconChevronDown size={16} />
          ) : (
            <IconChevronUp size={16} />
          )}
        </ActionIcon>
      </Group>

      {expanded && (
        <ScrollArea h={340} offsetScrollbars>
          <Stack gap="xs">
            {recentEntries.length === 0 && (
              <Text size="xs" c="dimmed" ta="center">
                No actions yet
              </Text>
            )}
            {recentEntries.map((entry) => (
              <Group key={entry.id} gap="xs" wrap="nowrap" align="flex-start">
                <Text size="xs" c="dimmed" style={{ whiteSpace: 'nowrap' }}>
                  {entry.timestamp.toLocaleTimeString([], {
                    hour: '2-digit',
                    minute: '2-digit',
                  })}
                </Text>
                <Badge
                  size="xs"
                  color={TYPE_COLORS[entry.type]}
                  variant="dot"
                />
                <Text size="xs" style={{ flex: 1 }}>
                  {entry.message}
                </Text>
              </Group>
            ))}
          </Stack>
        </ScrollArea>
      )}
    </Paper>
  );
}
```

Note: May need to install @tabler/icons-react if not already installed. Check package.json first. If not available, use a simple text indicator (▲/▼) instead of icons.
</action>
<verify>
Run: `npx tsc --noEmit -p apps/web/tsconfig.json`
GameLog compiles without errors.
</verify>
<done>
GameLog component created with collapsible panel, timestamps, and color-coded entries.
</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx nx typecheck web`
2. Notifications appear at bottom-center
3. GameLog panel expands/collapses
4. Entries persist in log after toasts dismiss
</verification>

<success_criteria>

- Mantine Notifications provider configured
- showGameNotification helper works
- GameLog shows scrollable history
- Toasts auto-close after 3 seconds
- UX-02 infrastructure ready (components can call showGameNotification)
- UX-03 infrastructure ready (errors use 'error' type notification)
  </success_criteria>

<output>
After completion, create `.planning/phases/07-robber/07-06-SUMMARY.md`
</output>
