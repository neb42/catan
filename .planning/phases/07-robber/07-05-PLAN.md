---
phase: 07-robber
plan: 05
type: execute
wave: 3
depends_on: ['07-01', '07-04']
files_modified:
  - apps/web/src/components/Robber/StealModal.tsx
  - apps/web/src/components/Game/GamePlayerList.tsx
autonomous: true

must_haves:
  truths:
    - 'Player can select victim to steal from in modal'
    - 'Opponent total resource counts are visible'
  artifacts:
    - path: 'apps/web/src/components/Robber/StealModal.tsx'
      provides: 'Victim selection UI'
      exports: ['StealModal']
    - path: 'apps/web/src/components/Game/GamePlayerList.tsx'
      provides: 'Player list with resource counts'
      contains: 'cardCount'
  key_links:
    - from: 'apps/web/src/components/Robber/StealModal.tsx'
      to: 'gameStore.stealCandidates'
      via: 'useStealCandidates hook'
      pattern: 'useStealCandidates'
---

<objective>
Implement steal victim selection modal and display opponent resource counts.

Purpose: Completes the robber UI by letting players choose who to steal from, and addresses RES-03 requirement by showing opponent card totals. This enhances game transparency and strategic decision-making.

Output: StealModal component, GamePlayerList showing opponent resource counts.
</objective>

<execution_context>
@/Users/bmcalindin/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bmcalindin/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-robber/07-CONTEXT.md
@.planning/phases/07-robber/07-RESEARCH.md
@.planning/phases/07-robber/07-04-SUMMARY.md

@apps/web/src/components/Game/GamePlayerList.tsx
@apps/web/src/stores/gameStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StealModal component</name>
  <files>
    apps/web/src/components/Robber/StealModal.tsx
    apps/web/src/components/Robber/index.ts
  </files>
  <action>
Create StealModal component for victim selection:

**apps/web/src/components/Robber/StealModal.tsx:**

```tsx
import { Modal, Button, Text, Stack, Group, Badge } from '@mantine/core';
import {
  useStealRequired,
  useStealCandidates,
  useGameStore,
} from '@web/stores/gameStore';

export function StealModal() {
  const stealRequired = useStealRequired();
  const candidates = useStealCandidates();
  const sendMessage = useGameStore((s) => s.sendMessage);

  if (!stealRequired || candidates.length === 0) return null;

  const handleSteal = (victimId: string) => {
    sendMessage({
      type: 'steal_target',
      victimId,
    });
  };

  return (
    <Modal
      opened={true}
      onClose={() => {}} // Cannot close - blocking
      closeOnClickOutside={false}
      closeOnEscape={false}
      withCloseButton={false}
      centered
      title="Choose a Player to Steal From"
      size="sm"
    >
      <Stack gap="md">
        <Text size="sm" c="dimmed">
          Select a player adjacent to the robber to steal one random card from.
        </Text>

        {candidates.map((candidate) => (
          <Button
            key={candidate.playerId}
            variant="light"
            fullWidth
            onClick={() => handleSteal(candidate.playerId)}
            styles={{
              root: {
                height: 'auto',
                padding: '12px 16px',
              },
            }}
          >
            <Group justify="space-between" w="100%">
              <Text fw={500}>{candidate.nickname}</Text>
              <Badge variant="filled" color="gray">
                {candidate.cardCount}{' '}
                {candidate.cardCount === 1 ? 'card' : 'cards'}
              </Badge>
            </Group>
          </Button>
        ))}
      </Stack>
    </Modal>
  );
}
```

**Update apps/web/src/components/Robber/index.ts:**

```typescript
export { DiscardModal } from './DiscardModal';
export { RobberPlacement } from './RobberPlacement';
export { RobberFigure } from './RobberFigure';
export { StealModal } from './StealModal';
```

  </action>
  <verify>
Run: `npx tsc --noEmit -p apps/web/tsconfig.json`
StealModal compiles and is exported.
  </verify>
  <done>
StealModal displays candidates with card counts, sends steal_target on selection.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add opponent resource counts to GamePlayerList</name>
  <files>apps/web/src/components/Game/GamePlayerList.tsx</files>
  <action>
Update GamePlayerList to show total card count for each player:

1. Get player resources from store for all players.

2. Calculate total card count per player:

```typescript
const getCardCount = (playerId: string): number => {
  const resources = playerResources[playerId];
  if (!resources) return 0;
  return Object.values(resources).reduce((sum, count) => sum + count, 0);
};
```

3. Display card count next to each player's name/row:

- For current player: can show detailed breakdown (already shown in ResourceHand)
- For opponents: show only total count

Add to each player row in the list:

```tsx
<Badge variant="light" color="gray" size="sm">
  {getCardCount(player.id)} cards
</Badge>
```

The card count should be visible for ALL players (including self) but the detailed breakdown is only visible for self via ResourceHand.

Example updated player row:

```tsx
<Group justify="space-between" w="100%">
  <Group gap="xs">
    {/* Existing player avatar/name */}
    <Avatar color={player.color} size="sm">
      {player.nickname[0].toUpperCase()}
    </Avatar>
    <Text>{player.nickname}</Text>
  </Group>
  <Badge variant="light" color="gray">
    {getCardCount(player.id)} cards
  </Badge>
</Group>
```

This addresses **RES-03**: User can see opponent resource counts (total only, not breakdown).
</action>
<verify>
Run: `npx tsc --noEmit -p apps/web/tsconfig.json`
GamePlayerList compiles with card count display.
</verify>
<done>
GamePlayerList shows total card count for each player (opponents see totals only, not breakdown).
</done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx nx typecheck web`
2. StealModal appears when steal_required received
3. GamePlayerList shows card counts for all players
</verification>

<success_criteria>

- StealModal displays candidate list with card counts
- Clicking candidate sends steal_target message
- Modal is blocking (cannot close without selecting)
- GamePlayerList shows total card count per player
- RES-03 requirement satisfied (opponent counts visible)
  </success_criteria>

<output>
After completion, create `.planning/phases/07-robber/07-05-SUMMARY.md`
</output>
