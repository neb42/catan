---
phase: 03-initial-placement
plan: 06
type: execute
wave: 3
depends_on: ['03-03', '03-04']
files_modified:
  - apps/web/src/components/PlacementBanner.tsx
  - apps/web/src/components/DraftOrderDisplay.tsx
  - apps/web/src/components/PlayerList.tsx
  - apps/web/src/components/Game.tsx
autonomous: true

must_haves:
  truths:
    - 'Banner shows current player and required action'
    - 'Player list highlights active player'
    - 'Full snake draft order visible with current position marked'
    - 'Waiting players see spectator info'
  artifacts:
    - path: 'apps/web/src/components/PlacementBanner.tsx'
      provides: 'Turn indicator banner during placement'
      exports: ['PlacementBanner']
    - path: 'apps/web/src/components/DraftOrderDisplay.tsx'
      provides: 'Snake draft order visualization'
      exports: ['DraftOrderDisplay']
  key_links:
    - from: 'apps/web/src/components/PlacementBanner.tsx'
      to: 'apps/web/src/hooks/usePlacementState.ts'
      via: 'Uses placement state for turn info'
      pattern: 'usePlacementState'
    - from: 'apps/web/src/components/Game.tsx'
      to: 'apps/web/src/components/PlacementBanner.tsx'
      via: 'Renders banner during placement phase'
      pattern: 'PlacementBanner'
---

<objective>
Create turn indication UI components for the initial placement phase.

Purpose: Players need to know whose turn it is, what action is required, and where they are in the snake draft order. The context specifies both banner and player list indication, plus full draft order visibility.

Output: PlacementBanner, DraftOrderDisplay components, updated PlayerList with active player highlighting.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-initial-placement/03-CONTEXT.md
@.planning/phases/03-initial-placement/03-RESEARCH.md
@apps/web/src/components/Game.tsx
@apps/web/src/components/PlayerList.tsx
@apps/web/src/hooks/usePlacementState.ts
@apps/web/src/stores/gameStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PlacementBanner and DraftOrderDisplay</name>
  <files>apps/web/src/components/PlacementBanner.tsx, apps/web/src/components/DraftOrderDisplay.tsx</files>
  <action>
Create `apps/web/src/components/PlacementBanner.tsx`:

```typescript
import { motion } from 'motion/react';
import { Paper, Text, Group, Badge } from '@mantine/core';
import { usePlacementState } from '../hooks/usePlacementState';
import { useGameStore } from '../stores/gameStore';

// Player color hex values
const PLAYER_COLOR_HEX: Record<string, string> = {
  red: '#E53935',
  blue: '#1E88E5',
  white: '#F5F5F5',
  orange: '#FB8C00',
  green: '#43A047',
  yellow: '#FDD835',
  purple: '#8E24AA',
  brown: '#6D4C41',
};

interface PlacementBannerProps {
  players: Array<{ id: string; nickname: string; color: string }>;
}

export function PlacementBanner({ players }: PlacementBannerProps) {
  const { phase, currentPlayerIndex, currentPlayerId, isMyTurn, draftRound } = usePlacementState();

  if (phase === null || currentPlayerIndex === null) return null;

  const currentPlayer = players[currentPlayerIndex];
  if (!currentPlayer) return null;

  const actionText = phase === 'settlement' ? 'Place Settlement' : 'Place Road';
  const colorHex = PLAYER_COLOR_HEX[currentPlayer.color] || currentPlayer.color;

  return (
    <motion.div
      initial={{ opacity: 0, y: -20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ type: 'spring', stiffness: 300, damping: 25 }}
      style={{
        position: 'absolute',
        top: 16,
        left: '50%',
        transform: 'translateX(-50%)',
        zIndex: 100,
      }}
    >
      <Paper
        shadow="md"
        p="sm"
        radius="md"
        style={{
          backgroundColor: 'rgba(255, 255, 255, 0.95)',
          borderLeft: `4px solid ${colorHex}`,
        }}
      >
        <Group gap="sm">
          {isMyTurn ? (
            <motion.div
              animate={{ scale: [1, 1.05, 1] }}
              transition={{ duration: 1.5, repeat: Infinity, ease: 'easeInOut' }}
            >
              <Text fw={700} size="lg" c="dark">
                Your Turn: {actionText}
              </Text>
            </motion.div>
          ) : (
            <Text size="lg" c="dimmed">
              <Text span fw={600} style={{ color: colorHex }}>
                {currentPlayer.nickname}
              </Text>
              {' is placing a '}
              <Text span fw={500}>{phase}</Text>
            </Text>
          )}

          <Badge variant="light" color="gray" size="sm">
            Round {draftRound}
          </Badge>
        </Group>
      </Paper>
    </motion.div>
  );
}
```

Create `apps/web/src/components/DraftOrderDisplay.tsx`:

```typescript
import { motion } from 'motion/react';
import { Paper, Text, Group, Box, Stack, Tooltip } from '@mantine/core';
import { useDraftOrder } from '../hooks/usePlacementState';

// Player color hex values
const PLAYER_COLOR_HEX: Record<string, string> = {
  red: '#E53935',
  blue: '#1E88E5',
  white: '#F5F5F5',
  orange: '#FB8C00',
  green: '#43A047',
  yellow: '#FDD835',
  purple: '#8E24AA',
  brown: '#6D4C41',
};

interface DraftOrderDisplayProps {
  players: Array<{ id: string; nickname: string; color: string }>;
}

export function DraftOrderDisplay({ players }: DraftOrderDisplayProps) {
  const draftOrder = useDraftOrder(players.length);

  // Group by round for display
  const round1 = draftOrder.filter((d) => d.round === 1);
  const round2 = draftOrder.filter((d) => d.round === 2);

  return (
    <Paper
      shadow="sm"
      p="xs"
      radius="md"
      style={{
        backgroundColor: 'rgba(255, 255, 255, 0.9)',
        maxWidth: 280,
      }}
    >
      <Stack gap="xs">
        <Text size="xs" fw={600} c="dimmed" tt="uppercase">
          Draft Order
        </Text>

        {/* Round 1 */}
        <Box>
          <Text size="xs" c="dimmed" mb={4}>Round 1 (1→{players.length})</Text>
          <Group gap={4} wrap="wrap">
            {round1.map((position) => {
              const player = players[position.playerIndex];
              const colorHex = PLAYER_COLOR_HEX[player?.color] || '#ccc';
              const isSettlement = position.phase === 'settlement';

              return (
                <Tooltip
                  key={position.turnNumber}
                  label={`${player?.nickname || `P${position.playerIndex + 1}`}: ${position.phase}`}
                  position="top"
                  withArrow
                >
                  <motion.div
                    animate={position.isCurrent ? {
                      scale: [1, 1.15, 1],
                      boxShadow: [`0 0 0 0 ${colorHex}`, `0 0 0 4px ${colorHex}40`, `0 0 0 0 ${colorHex}`],
                    } : {}}
                    transition={{ duration: 1.5, repeat: position.isCurrent ? Infinity : 0 }}
                    style={{
                      width: 20,
                      height: 20,
                      borderRadius: isSettlement ? 4 : '50%',
                      backgroundColor: colorHex,
                      border: position.isCurrent ? '2px solid #333' : '1px solid rgba(0,0,0,0.2)',
                      opacity: position.isCurrent ? 1 : 0.6,
                    }}
                  />
                </Tooltip>
              );
            })}
          </Group>
        </Box>

        {/* Round 2 */}
        <Box>
          <Text size="xs" c="dimmed" mb={4}>Round 2 ({players.length}→1)</Text>
          <Group gap={4} wrap="wrap">
            {round2.map((position) => {
              const player = players[position.playerIndex];
              const colorHex = PLAYER_COLOR_HEX[player?.color] || '#ccc';
              const isSettlement = position.phase === 'settlement';

              return (
                <Tooltip
                  key={position.turnNumber}
                  label={`${player?.nickname || `P${position.playerIndex + 1}`}: ${position.phase}`}
                  position="top"
                  withArrow
                >
                  <motion.div
                    animate={position.isCurrent ? {
                      scale: [1, 1.15, 1],
                      boxShadow: [`0 0 0 0 ${colorHex}`, `0 0 0 4px ${colorHex}40`, `0 0 0 0 ${colorHex}`],
                    } : {}}
                    transition={{ duration: 1.5, repeat: position.isCurrent ? Infinity : 0 }}
                    style={{
                      width: 20,
                      height: 20,
                      borderRadius: isSettlement ? 4 : '50%',
                      backgroundColor: colorHex,
                      border: position.isCurrent ? '2px solid #333' : '1px solid rgba(0,0,0,0.2)',
                      opacity: position.isCurrent ? 1 : 0.6,
                    }}
                  />
                </Tooltip>
              );
            })}
          </Group>
        </Box>

        {/* Legend */}
        <Group gap="xs" mt={4}>
          <Group gap={4}>
            <Box w={12} h={12} style={{ backgroundColor: '#ccc', borderRadius: 2 }} />
            <Text size="xs" c="dimmed">Settlement</Text>
          </Group>
          <Group gap={4}>
            <Box w={12} h={12} style={{ backgroundColor: '#ccc', borderRadius: '50%' }} />
            <Text size="xs" c="dimmed">Road</Text>
          </Group>
        </Group>
      </Stack>
    </Paper>
  );
}
```

  </action>
  <verify>Run `npx nx build web` - builds without TypeScript errors</verify>
  <done>PlacementBanner shows current turn, DraftOrderDisplay shows full snake order</done>
</task>

<task type="auto">
  <name>Task 2: Update PlayerList with active player highlighting and integrate into Game</name>
  <files>apps/web/src/components/PlayerList.tsx, apps/web/src/components/Game.tsx</files>
  <action>
Update `apps/web/src/components/PlayerList.tsx` to add active player highlighting:

Add import:

```typescript
import { motion } from 'motion/react';
import { useCurrentPlayer } from '../stores/gameStore';
```

Inside the PlayerList component:

1. Get current player: `const { id: currentPlayerId } = useCurrentPlayer();`
2. For each player item, check if `player.id === currentPlayerId`
3. If active, add visual highlighting:
   - Pulsing glow effect using Motion
   - Border highlight in player's color
   - "Currently placing" indicator

Example modification to player item:

```typescript
{players.map((player) => {
  const isActive = player.id === currentPlayerId;

  return (
    <motion.div
      key={player.id}
      animate={isActive ? {
        boxShadow: [
          `0 0 0 0 ${PLAYER_COLOR_HEX[player.color]}40`,
          `0 0 0 8px ${PLAYER_COLOR_HEX[player.color]}40`,
          `0 0 0 0 ${PLAYER_COLOR_HEX[player.color]}40`,
        ],
      } : {}}
      transition={{ duration: 2, repeat: isActive ? Infinity : 0 }}
      style={{
        borderRadius: 8,
        border: isActive ? `2px solid ${PLAYER_COLOR_HEX[player.color]}` : 'none',
      }}
    >
      {/* Existing player item content */}
      {isActive && (
        <Badge size="xs" color="green" ml="xs">
          Placing
        </Badge>
      )}
    </motion.div>
  );
})}
```

Update `apps/web/src/components/Game.tsx` to render placement UI:

Add imports:

```typescript
import { PlacementBanner } from './PlacementBanner';
import { DraftOrderDisplay } from './DraftOrderDisplay';
import { PlacementControls } from './Board/PlacementControls';
import { usePlacementState } from '../hooks/usePlacementState';
```

Inside Game component render:

1. Get players array from room state (already available from context)
2. Check if in placement phase using usePlacementState
3. Render PlacementBanner at top center during placement
4. Render DraftOrderDisplay in sidebar (right side) during placement
5. Render PlacementControls at bottom center during placement

Layout structure:

```typescript
<div style={{ position: 'relative', width: '100%', height: '100vh' }}>
  {/* Placement UI (only during setup) */}
  {placementPhase && (
    <>
      <PlacementBanner players={players} />
      <div style={{ position: 'absolute', top: 80, right: 16 }}>
        <DraftOrderDisplay players={players} />
      </div>
    </>
  )}

  {/* Board in center */}
  <Board ... />

  {/* Placement controls at bottom */}
  <PlacementControls />

  {/* Player list on left side */}
  <div style={{ position: 'absolute', top: 80, left: 16 }}>
    <PlayerList players={players} ... />
  </div>
</div>
```

  </action>
  <verify>Run `npx nx build web` - builds without TypeScript errors</verify>
  <done>PlayerList highlights active player, Game integrates all placement UI components</done>
</task>

</tasks>

<verification>
1. `npx nx build web` succeeds
2. Banner shows "Your Turn: Place Settlement" when it's your turn
3. Banner shows "PlayerName is placing a settlement" when waiting
4. DraftOrderDisplay shows all 16 positions with current highlighted
5. PlayerList pulses/glows for active player
6. All components position correctly in Game layout
</verification>

<success_criteria>

- Banner clearly indicates whose turn and what action
- Waiting players see spectator-appropriate info
- Full snake order visible (1→2→3→4→4→3→2→1)
- Current position in draft highlighted with animation
- Active player highlighted in player list
  </success_criteria>

<output>
After completion, create `.planning/phases/03-initial-placement/03-06-SUMMARY.md`
</output>
