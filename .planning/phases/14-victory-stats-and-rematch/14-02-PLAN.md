---
phase: 14-victory-stats-and-rematch
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - apps/web/src/components/Victory/StatisticsTabs.tsx
  - apps/web/src/components/Victory/DiceDistributionChart.tsx
  - apps/web/src/components/Victory/DevCardStatsChart.tsx
  - apps/web/src/components/Victory/ResourceStatsChart.tsx
autonomous: true

must_haves:
  truths:
    - 'Mantine Charts library is installed and available'
    - 'Dice stats render as bar chart'
    - 'Dev card stats show per-player breakdown'
    - 'Resource stats show gained/spent/traded separately'
  artifacts:
    - path: 'apps/web/src/components/Victory/StatisticsTabs.tsx'
      provides: 'Tabbed container for statistics'
      min_lines: 80
      exports: ['StatisticsTabs']
    - path: 'apps/web/src/components/Victory/DiceDistributionChart.tsx'
      provides: 'Bar chart for dice frequencies'
      min_lines: 40
      exports: ['DiceDistributionChart']
    - path: 'apps/web/src/components/Victory/ResourceStatsChart.tsx'
      provides: 'Resource flow visualization'
      min_lines: 60
      exports: ['ResourceStatsChart']
  key_links:
    - from: 'apps/web/src/components/Victory/DiceDistributionChart.tsx'
      to: '@mantine/charts'
      via: 'import BarChart'
      pattern: "import.*BarChart.*from '@mantine/charts'"
    - from: 'apps/web/src/components/Victory/StatisticsTabs.tsx'
      to: 'Tabs component'
      via: '@mantine/core'
      pattern: "import.*Tabs.*from '@mantine/core'"
---

<objective>
Install visualization library and create chart components for displaying game statistics.

Purpose: Build reusable chart components that render statistics data with parchment aesthetic matching game theme. Components are props-driven and ready for integration into VictoryModal.

Output: Three chart components and tabbed container, all styled consistently with existing parchment theme.
</objective>

<execution_context>
@/Users/bmcalindin/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bmcalindin/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-victory-stats-and-rematch/14-CONTEXT.md
@.planning/phases/14-victory-stats-and-rematch/14-RESEARCH.md

# Existing victory modal styling

@apps/web/src/components/Victory/VictoryModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Install @mantine/charts and recharts</name>
  <files>
    package.json
  </files>
  <action>
Run installation from workspace root:
```bash
npm install @mantine/charts recharts
```

Verify installation in package.json after completion. Both packages should be in dependencies.
</action>
<verify>
grep -E "@mantine/charts|recharts" package.json confirms both packages installed
npm list @mantine/charts recharts shows installed versions
</verify>
<done>
@mantine/charts and recharts are listed in package.json dependencies and node_modules exists.
</done>
</task>

<task type="auto">
  <name>Create DiceDistributionChart component</name>
  <files>
    apps/web/src/components/Victory/DiceDistributionChart.tsx
  </files>
  <action>
Create functional component that accepts `diceRolls: Record<number, number>` prop.

Transform data into array format: `[{ number: 2, count: 5 }, { number: 3, count: 8 }, ...]` for numbers 2-12.

Use Mantine BarChart:

```tsx
import { BarChart } from '@mantine/charts';

<BarChart
  h={300}
  data={chartData}
  dataKey="number"
  series={[{ name: 'count', color: '#8d6e63', label: 'Rolls' }]}
  xAxisLabel="Dice Number"
  yAxisLabel="Frequency"
  style={{ background: 'transparent' }}
/>;
```

Wrap in Stack with Title: "Dice Roll Distribution". Use parchment text color (#5d4037), Fraunces font for title.
</action>
<verify>
npx nx typecheck web
Component renders without errors when passed empty object
</verify>
<done>
DiceDistributionChart component exists, accepts diceRolls prop, renders BarChart with parchment styling.
</done>
</task>

<task type="auto">
  <name>Create DevCardStatsChart component</name>
  <files>
    apps/web/src/components/Victory/DevCardStatsChart.tsx
  </files>
  <action>
Create functional component accepting `devCardStats: Record<string, DevelopmentCardType[]>` and `players: Player[]` props.

Display two sections:

1. **Overall totals**: Count by card type (Knight: X, VictoryPoint: Y, RoadBuilding: Z, YearOfPlenty: W, Monopoly: V)
2. **Per-player breakdown**: Table or cards showing each player's drawn cards with their avatar/color

Use Group/Stack layout:

- Title "Development Cards Drawn"
- Overall section: Badge components showing counts per card type
- Per-player section: Cards with player avatar, nickname, and list of their dev cards (with card type icons/names)

Use player colors from PLAYER_COLOR_HEX for player identification. Maintain parchment aesthetic.
</action>
<verify>
npx nx typecheck web
Component renders with mock data showing both sections
</verify>
<done>
DevCardStatsChart component exists, shows overall totals and per-player breakdown with player colors.
</done>
</task>

<task type="auto">
  <name>Create ResourceStatsChart and StatisticsTabs container</name>
  <files>
    apps/web/src/components/Victory/ResourceStatsChart.tsx
    apps/web/src/components/Victory/StatisticsTabs.tsx
  </files>
  <action>
**ResourceStatsChart.tsx:**
Accept `resourceStats: Record<string, { gained, spent, traded }>` and `players: Player[]` props.

Show three subsections:

1. "Resources Collected" - Stacked bar chart showing resources gained from dice rolls per player
2. "Resources Spent" - Stacked bar chart showing resources spent on buildings/cards per player
3. "Trade Activity" - Net trade flow (positive = received more, negative = gave more) per player

Use Mantine BarChart with `type="stacked"` for gained/spent sections. Use player colors for bars. Include legend mapping players to colors.

**StatisticsTabs.tsx:**
Create Tabs container with three tabs:

1. "Dice Stats" -> DiceDistributionChart
2. "Dev Cards" -> DevCardStatsChart
3. "Resources" -> ResourceStatsChart

Accept `stats: GameStats` and `players: Player[]` props. Pass appropriate data to each chart component.

Use Mantine Tabs with custom styling:

```tsx
<Tabs defaultValue="dice" styles={{
  root: { background: '#fdf6e3' },
  tab: {
    color: '#5d4037',
    '&[data-active]': {
      borderBottomColor: '#8d6e63',
      color: '#8d6e63'
    }
  },
  panel: { paddingTop: 16 }
}}>
```

  </action>
  <verify>
npx nx typecheck web
StatisticsTabs renders all three tabs, switches between them correctly
  </verify>
  <done>
ResourceStatsChart shows three resource subsections. StatisticsTabs wraps all charts in tabbed interface with parchment styling.
  </done>
</task>

</tasks>

<verification>
Type check frontend:
```bash
npx nx typecheck web
```

Verify all components export correctly:

```bash
rg "export.*function (StatisticsTabs|DiceDistributionChart|DevCardStatsChart|ResourceStatsChart)" apps/web/src/components/Victory/
```

Verify Mantine Charts import:

```bash
rg "@mantine/charts" apps/web/src/components/Victory/
```

</verification>

<success_criteria>

1. **Libraries installed** — @mantine/charts and recharts in package.json
2. **Chart components created** — Four new files exist with proper exports
3. **Styling consistent** — All components use parchment colors, Fraunces font for titles
4. **Props-driven** — Components accept data props and render appropriately
   </success_criteria>

<output>
After completion, create `.planning/phases/14-victory-stats-and-rematch/14-02-SUMMARY.md` following summary template guidelines.
</output>
