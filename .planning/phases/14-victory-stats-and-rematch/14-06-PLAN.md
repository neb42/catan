---
phase: 14-victory-stats-and-rematch
plan: 06
type: checkpoint:human-verify
wave: 3
depends_on: [14-04, 14-05]
files_modified: []
autonomous: false
gate: blocking

must_haves:
  truths:
    - 'Statistics display correctly in victory modal'
    - 'Rematch flow works end-to-end'
    - 'Results breakdown shows winner clearly'
---

<objective>
Human verification of complete victory statistics and rematch functionality.

Purpose: Validate that all statistics display correctly, rematch voting works, and visual styling meets design requirements.

Output: Verified phase completion with all features working.
</objective>

<execution_context>
@/Users/bmcalindin/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bmcalindin/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-victory-stats-and-rematch/14-CONTEXT.md

# Phase 14 completed work

@.planning/phases/14-victory-stats-and-rematch/14-01-SUMMARY.md
@.planning/phases/14-victory-stats-and-rematch/14-02-SUMMARY.md
@.planning/phases/14-victory-stats-and-rematch/14-03-SUMMARY.md
@.planning/phases/14-victory-stats-and-rematch/14-04-SUMMARY.md
@.planning/phases/14-victory-stats-and-rematch/14-05-SUMMARY.md
</context>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete victory statistics display and rematch functionality:
- GameStats class tracking dice rolls, resources, dev cards throughout game
- Three chart components (dice distribution, dev cards, resources) with Mantine Charts
- StatisticsTabs component organizing charts in tabbed interface
- Enhanced ResultsBreakdown with detailed VP breakdown and winner emphasis
- Rematch voting system with backend vote tracking and game reset
- Rematch UI with ready count display and player checkmarks
- WebSocket handlers for rematch_update and game_reset messages
  </what-built>
  
  <how-to-verify>
**Test Statistics Display:**

1. Start development servers:

   ```bash
   npx nx serve api
   npx nx serve web
   ```

2. Play a complete game to victory:
   - Create room with 3-4 players (open multiple browser windows)
   - Complete initial placement
   - Play several turns with dice rolls, building, trading, dev cards
   - Reach 10 VP to trigger victory

3. Verify Victory Modal Statistics:
   - Modal appears with winner announcement and confetti
   - **Results Breakdown:**
     - All players shown ranked by VP (highest to lowest)
     - Winner card has: trophy icon (üèÜ), gold border, emphasized styling
     - Each player shows detailed VP breakdown: settlements, cities, longest road (if applicable), largest army (if applicable), VP cards (if applicable)
   - **Statistics Tabs:**
     - Three tabs visible: "Dice Stats", "Dev Cards", "Resources"
     - **Dice Stats tab:**
       - Bar chart showing frequency of each roll (2-12)
       - Chart matches actual rolls from game log
     - **Dev Cards tab:**
       - Overall totals section showing count by card type
       - Per-player breakdown showing which cards each player drew
       - Player colors used for identification
     - **Resources tab:**
       - Three sections: Resources Collected, Resources Spent, Trade Activity
       - Data matches game events (resources from dice, resources spent on buildings, trade flows)
   - Modal scrolls if content exceeds viewport height
   - Parchment aesthetic maintained throughout (beige backgrounds, brown text, Fraunces font)

4. Verify Rematch Flow:
   - Click "Rematch" button in victory modal
   - Button becomes disabled with "Waiting for others..." text
   - Ready count displays: "Ready for rematch: 1/X players"
   - Checkmark appears next to your player name
   - Have other players click Rematch in their modals
   - When all players vote:
     - Modal closes
     - Toast notification: "New game starting!"
     - New board generates (different from previous game)
     - Players return to lobby state with ready buttons
     - All game state cleared (no roads, settlements, resources from previous game)
   - Can start new game normally with ready countdown

5. Edge Cases:
   - Close modal and click "Show Results" button - modal reopens with all statistics intact
   - Check console for errors - should be clean
   - Verify all three chart types render without errors
   - Test rematch with minimum players (3) and maximum players (4)

**Expected Behavior:**

- Victory modal displays comprehensive statistics matching game events
- Winner clearly distinguished with trophy, gold styling, emphasized card
- All three statistics tabs render correctly with accurate data
- Charts use player colors from game (not generic colors)
- Rematch voting shows transparent progress with player checkmarks
- Unanimous vote triggers smooth transition to new game
- All state properly reset between games
- No console errors or visual glitches

**Styling Checklist:**

- [ ] Parchment background (#fdf6e3) maintained
- [ ] Brown text (#5d4037) consistent
- [ ] Fraunces font used for titles
- [ ] Player colors from game used in charts
- [ ] Winner has all visual indicators (trophy, gold, emphasis)
- [ ] Modal scrolls smoothly with long content
- [ ] Tabs switch cleanly without layout shift
- [ ] Charts render clearly with readable labels
    </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass and statistics/rematch work correctly.

If issues found, describe specific problems:

- Which chart has incorrect data?
- Does rematch voting not trigger reset?
- Are visual styles inconsistent?
- Any console errors?
  </resume-signal>
  </task>

<verification>
Complete end-to-end testing of Phase 14 features integrated with full game flow.
</verification>

<success_criteria>

1. **Statistics accurate** ‚Äî All charts show correct data matching game events
2. **Rematch works** ‚Äî Voting, reset, and new game flow complete successfully
3. **Styling consistent** ‚Äî Parchment aesthetic maintained, winner clearly distinguished
4. **No regressions** ‚Äî Existing victory modal features still work
   </success_criteria>

<output>
After approval, create `.planning/phases/14-victory-stats-and-rematch/14-06-SUMMARY.md` documenting verification results and any issues found.
</output>
