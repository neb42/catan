---
phase: 10-largest-army
plan: 03
type: execute
wave: 3
depends_on: ['10-02']
files_modified:
  - apps/web/src/components/GamePlayerList.tsx
autonomous: false

must_haves:
  truths:
    - 'Largest Army badge appears next to holder in player list'
    - 'Knight count displays for all players'
    - 'Badge animates on transfer (matches Longest Road treatment)'
  artifacts:
    - path: 'apps/web/src/components/GamePlayerList.tsx'
      provides: 'Largest Army badge and knight count display'
      contains: 'Largest Army'
  key_links:
    - from: 'apps/web/src/components/GamePlayerList.tsx'
      to: 'gameStore.largestArmyHolderId'
      via: 'useLargestArmyHolder hook'
      pattern: 'useLargestArmyHolder'
---

<objective>
Add Largest Army badge and knight count display to GamePlayerList component.

Purpose: Show largest army holder visually in the player list with knight counts for all players
Output: UI display matching Longest Road treatment (badge, animation, tooltip)
</objective>

<execution_context>
@/Users/bmcalindin/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bmcalindin/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-largest-army/10-01-SUMMARY.md
@.planning/phases/10-largest-army/10-02-SUMMARY.md

Key reference file:
@apps/web/src/components/GamePlayerList.tsx ‚Äî Add Largest Army badge parallel to Longest Road badge
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Largest Army badge and update knight count display</name>
  <files>
    apps/web/src/components/GamePlayerList.tsx
  </files>
  <action>
1. Import the new selectors at top (around line 17-18):

```typescript
import {
  useCurrentPlayer,
  useGameStore,
  useTurnCurrentPlayer,
  useLongestRoadHolder,
  usePlayerRoadLengths,
  useLargestArmyHolder,
  usePlayerKnightCounts,
} from '../stores/gameStore';
```

2. Add state hooks inside the component (around line 48, after longestRoadHolderId):

```typescript
// Largest army state
const largestArmyHolderId = useLargestArmyHolder();
const playerKnightCounts = usePlayerKnightCounts();
```

3. Inside the player map (around line 71), add knight count and largest army flag:

```typescript
// Knight count and largest army status
const knightCount =
  playerKnightCounts[player.id] || knightsPlayed[player.id] || 0;
const hasLargestArmy = player.id === largestArmyHolderId;
```

4. Add Largest Army badge in the Group with badges (around line 187, after the Longest Road badge):

```typescript
{/* Largest Army badge */}
{hasLargestArmy && (
  <motion.div
    initial={{ scale: 0 }}
    animate={{ scale: 1 }}
    transition={{
      type: 'spring',
      stiffness: 500,
      damping: 30,
    }}
  >
    <Tooltip label="Largest Army (2 VP)" position="top">
      <Badge size="sm" color="red" variant="filled">
        üõ°Ô∏è Largest
      </Badge>
    </Tooltip>
  </motion.div>
)}
```

5. Update the knights played badge to show for all players with knight counts (not just > 0):
   Find the existing knights badge (around line 162) and update it to always show for players with 1+ knights:

```typescript
{/* Knights played - show count for all players */}
<Tooltip label={`Knights played: ${knightCount}`} position="top">
  <Badge size="sm" color="orange" variant="light">
    ‚öîÔ∏è {knightCount}
  </Badge>
</Tooltip>
```

Remove the conditional `{(knightsPlayed[player.id] || 0) > 0 &&` wrapper - always show the knight count badge for consistency with the decision to "Always show count even for players with 0 knights played".
</action>
<verify>
Run `cd apps/web && npm run build` - builds without errors.
Run `npm run dev` and visually verify:

- Knight count badge shows for all players (including 0)
- When a player gets 3+ knights (after testing with dev tools), Largest Army badge appears
  </verify>
  <done>
  GamePlayerList shows Largest Army badge for holder with spring animation, knight counts visible for all players
  </done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Largest Army tracking and UI:
- Backend recalculates largest army on knight plays (min 3 knights required)
- WebSocket broadcasts largest_army_updated on transfers
- Frontend state updates and shows toast notifications
- GamePlayerList displays Largest Army badge (üõ°Ô∏è) for holder
- Knight counts visible for all players
  </what-built>
  <how-to-verify>
1. Start the dev servers: `npm run dev` (in root)
2. Open 3-4 browser tabs to same room
3. Start game and play through to main phase
4. Have one player buy 3+ knight cards across turns (buy dev card, wait turn, play knight)
5. Verify:
   - Knight count badge updates after each knight play
   - When player reaches 3 knights, Largest Army badge (üõ°Ô∏è) appears with animation
   - Toast notification shows "[Player] earns Largest Army (3 knights)!"
   - Have another player exceed with 4+ knights
   - Verify badge transfers with animation
   - Toast shows "[New Player] earns Largest Army from [Old Player]!"
6. Verify badge matches Longest Road styling (same position, animation pattern)
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Run `cd apps/web && npm run build` - frontend builds
2. Manual verification of largest army flow end-to-end
3. Confirm visual consistency with Longest Road badge treatment
</verification>

<success_criteria>

- Largest Army badge visible in player list for holder
- Knight counts visible for all players
- Spring animation on badge appearance/transfer
- Toast notifications on earn/transfer
- Visual consistency with Longest Road treatment
  </success_criteria>

<output>
After completion, create `.planning/phases/10-largest-army/10-03-SUMMARY.md`
</output>
