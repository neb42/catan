---
phase: 12-resilience-polish
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/Board.tsx
  - apps/web/src/components/Lobby.tsx
  - apps/web/src/components/BuildControls.tsx
  - apps/web/src/components/TradeModal.tsx
  - apps/web/src/components/PlayerList.tsx
  - apps/web/src/index.css
autonomous: true

must_haves:
  truths:
    - 'Game interface is playable on mobile devices (360px width minimum)'
    - 'Touch targets are minimum 44px for buttons and interactive elements'
    - 'Board scales to fit mobile viewport'
    - 'Modals and overlays work on mobile screen sizes'
  artifacts:
    - path: 'apps/web/src/index.css'
      provides: 'Mobile viewport fixes and base responsive styles'
      contains: 'dvh.*mobile'
    - path: 'apps/web/src/components/Board.tsx'
      provides: 'Responsive board scaling'
      min_lines: 200
    - path: 'apps/web/src/components/Lobby.tsx'
      provides: 'Mobile-friendly lobby layout'
      min_lines: 200
  key_links:
    - from: 'apps/web/src/index.css'
      to: 'height.*100dvh'
      via: 'dynamic viewport units'
      pattern: 'dvh'
    - from: 'apps/web/src/components/BuildControls.tsx'
      to: 'minHeight.*44'
      via: 'touch-friendly targets'
      pattern: '44px'
---

<objective>
Polish UI for mobile devices with responsive layouts, touch-friendly targets, and viewport fixes.

Purpose: Make game fully playable on mobile phones (360px-428px width) with proper scaling and touch interaction.

Output: All components responsive at 360px+ width, buttons/interactive elements minimum 44px, board scales to fit mobile viewport, modals work on small screens, uses dvh units for mobile Safari compatibility.
</objective>

<execution_context>
@/Users/bmcalindin/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bmcalindin/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-resilience-polish/12-CONTEXT.md
@.planning/phases/12-resilience-polish/12-RESEARCH.md
@apps/web/src/components/Board.tsx
@apps/web/src/components/Lobby.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mobile viewport fixes and touch target standards</name>
  <files>
    apps/web/src/index.css
    apps/web/src/components/BuildControls.tsx
    apps/web/src/components/TradeModal.tsx
    apps/web/src/components/Lobby.tsx
  </files>
  <action>
Apply mobile viewport fixes and ensure all interactive elements meet 44px minimum touch target size.

**In index.css:**
Add mobile viewport fixes:

```css
/* Mobile viewport fix for Safari address bar */
html,
body,
#root {
  height: 100dvh; /* Use dynamic viewport height instead of vh */
  width: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
}

/* Touch target minimum */
button,
a,
[role='button'] {
  min-height: 44px;
  min-width: 44px;
}

/* Prevent text selection on touch */
.game-board,
.player-list,
.build-controls {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}
```

Use `dvh` (dynamic viewport height) instead of `vh` to handle mobile Safari's collapsing address bar (per research findings). This prevents layout shifts when scrolling.

**In BuildControls.tsx:**
Ensure all buttons meet 44px minimum:

- Check Button components have size="md" or larger (Mantine md = 42px, lg = 50px)
- If custom height, set minHeight: 44
- Add padding to increase touch area if needed

**In TradeModal.tsx:**
Check resource increment/decrement buttons are 44px+:

- Use size="md" for ActionIcon components
- Ensure resource selection cards have adequate touch area

**In Lobby.tsx:**
Check all interactive elements (color picker dots, ready button, copy button) are 44px+:

- Color picker dots should be at least 44px diameter
- Buttons should use size="lg" for better mobile UX

Per research, 44px is Apple/Google recommended minimum touch target for accessibility and usability. Larger is better on mobile.
</action>
<verify>
Check index.css uses dvh units for height
Check buttons in BuildControls, TradeModal, Lobby have minHeight 44px
Open Chrome DevTools, toggle device toolbar, test at 360px width
Verify buttons are easily tappable without zooming
</verify>
<done>
All interactive elements meet 44px minimum touch target, viewport uses dvh units for mobile Safari compatibility, touch selection disabled on game elements to prevent accidental text selection.
</done>
</task>

<task type="auto">
  <name>Task 2: Make layouts responsive for mobile screens</name>
  <files>
    apps/web/src/components/Board.tsx
    apps/web/src/components/PlayerList.tsx
    apps/web/src/components/GameLog.tsx
    apps/web/src/components/Lobby.tsx
  </files>
  <action>
Adapt component layouts to work on mobile screens (360px-428px width).

**In Board.tsx:**
Add responsive scaling for hex board:

```typescript
const boardScale = useMediaQuery('(max-width: 768px)') ? 0.6 : 1.0;

// Apply scale to HexGrid container:
<div style={{ transform: `scale(${boardScale})`, transformOrigin: 'top left' }}>
  <HexGrid>{/* hexes */}</HexGrid>
</div>
```

Use Mantine's useMediaQuery hook to detect mobile. Scale board down to 60% on mobile so it fits viewport.

Position BuildControls and PlayerList in mobile-friendly layout:

- Desktop: PlayerList right side, BuildControls bottom
- Mobile: Stack vertically, use collapsible sections

**In PlayerList.tsx:**
Make player cards stack on mobile:

```typescript
<Group spacing="sm" style={{
  flexDirection: width < 768 ? 'column' : 'row',
  alignItems: 'stretch',
}}>
  {players.map(player => <PlayerCard />)}
</Group>
```

**In GameLog.tsx:**
On mobile, default to CLOSED state:

```typescript
const isMobile = useMediaQuery('(max-width: 768px)');
const [isOpen, setIsOpen] = useState(!isMobile); // Closed on mobile
```

When open on mobile, take full width (not just 300px) to maximize space.

**In Lobby.tsx:**
Ensure 2x2 player grid from Phase 1.1 stacks to 1 column on mobile:

```typescript
<SimpleGrid cols={{ base: 1, sm: 2 }} spacing="md">
  {players.map(player => <PlayerCard />)}
</SimpleGrid>
```

Use Mantine responsive props: `cols={{ base: 1, sm: 2 }}` means 1 column on mobile (< 768px), 2 columns on tablet+.

Test breakpoints: 360px (small phone), 428px (large phone), 768px (tablet). Priority is 360px minimum support.
</action>
<verify>
Open browser DevTools, set device to iPhone SE (375px width)
Check board scales to fit screen without horizontal scroll
Check player list stacks vertically
Check game log defaults to closed on mobile
Check lobby player grid shows 1 column on mobile
Verify no horizontal scrolling at 360px width
</verify>
<done>
Board scales to 60% on mobile screens, player list stacks vertically on mobile, game log defaults closed on mobile, lobby grid responsive (1 col mobile, 2 cols tablet+), all layouts fit 360px minimum width without horizontal scroll.
</done>
</task>

</tasks>

<verification>
Mobile testing checklist:
1. Open game on iPhone (real device or DevTools)
2. Test lobby: join room, pick color, mark ready
3. Test game: view board, build road, see player list, open log
4. Test modals: trade modal, discard modal on mobile
5. Verify all buttons tappable without zoom
6. Check no horizontal scrolling at 360px width
</verification>

<success_criteria>

- index.css uses dvh units for viewport height
- All buttons meet 44px minimum touch target
- Board scales to 60% on screens < 768px
- Player list stacks vertically on mobile
- Game log defaults to closed on mobile
- Lobby player grid uses responsive cols (1 on mobile, 2 on tablet)
- No horizontal scrolling at 360px width
- Touch selection disabled on game elements
- All modals fit mobile screen without overflow
  </success_criteria>

<output>
After completion, create `.planning/phases/12-resilience-polish/12-05-SUMMARY.md`
</output>
