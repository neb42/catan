---
phase: 11-victory
plan: 03
type: execute
wave: 2
depends_on: ['11-01']
files_modified:
  - apps/web/src/stores/gameStore.ts
  - apps/web/src/components/GamePlayerList.tsx
autonomous: true

must_haves:
  truths:
    - "User can see all players' public victory point counts"
    - 'VP breakdown shown inline with compact icons'
    - 'Hidden VP cards are not displayed to opponents'
  artifacts:
    - path: 'apps/web/src/stores/gameStore.ts'
      provides: 'VictorySlice with VP calculation selectors'
      contains: 'VictorySlice'
    - path: 'apps/web/src/components/GamePlayerList.tsx'
      provides: 'Inline VP display with icon format'
      contains: 'üè†'
  key_links:
    - from: 'GamePlayerList.tsx'
      to: 'gameStore VictorySlice'
      via: 'usePlayerVP selector'
      pattern: 'usePlayerVP|usePublicVP'
---

<objective>
Display public victory points inline in player list with compact icon format.

Purpose: Enable players to see current VP standings at a glance during gameplay, fulfilling SCORE-08 requirement.
Output: GamePlayerList shows VP breakdown for each player using compact icon format per CONTEXT.md.
</objective>

<execution_context>
@/Users/bmcalindin/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/bmcalindin/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/11-victory/11-01-SUMMARY.md
@.planning/phases/11-victory/11-CONTEXT.md

# Key files

@apps/web/src/stores/gameStore.ts
@apps/web/src/components/GamePlayerList.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add VP calculation to gameStore</name>
  <files>apps/web/src/stores/gameStore.ts</files>
  <action>
The store already has all the data needed for VP calculation. Add a derived selector that calculates public VP for display.

**Add VictorySlice interface:**

```typescript
interface VictorySlice {
  gameEnded: boolean;
  winnerId: string | null;
}
```

Add VictorySlice to GameStore interface and initial state:

```typescript
// Initial state
gameEnded: false,
winnerId: null,
```

Add action to set victory state:

```typescript
setVictoryState: (winnerId: string | null) => void;
```

**Add selector hook for calculating public VP:**

```typescript
export function usePlayerPublicVP(playerId: string): {
  settlements: number;
  cities: number;
  longestRoad: number;
  largestArmy: number;
  total: number;
} {
  return useGameStore(
    useShallow((state) => {
      const playerSettlements = state.settlements.filter(
        (s) => s.playerId === playerId,
      );
      const settlementCount = playerSettlements.filter((s) => !s.isCity).length;
      const cityCount = playerSettlements.filter((s) => s.isCity).length;
      const longestRoad = state.longestRoadHolderId === playerId ? 2 : 0;
      const largestArmy = state.largestArmyHolderId === playerId ? 2 : 0;

      // Note: VP cards are hidden until game ends, so NOT included in public VP
      return {
        settlements: settlementCount,
        cities: cityCount * 2,
        longestRoad,
        largestArmy,
        total: settlementCount + cityCount * 2 + longestRoad + largestArmy,
      };
    }),
  );
}
```

**Note per CONTEXT.md:** Hidden VP cards are completely invisible - do NOT show any placeholder or "? VP".
</action>
<verify>npm run typecheck</verify>
<done>VictorySlice added to gameStore, usePlayerPublicVP selector calculates VP from existing state</done>
</task>

<task type="auto">
  <name>Task 2: Display VP breakdown in GamePlayerList</name>
  <files>apps/web/src/components/GamePlayerList.tsx</files>
  <action>
Modify GamePlayerList to show inline VP breakdown per CONTEXT.md decisions.

**Add VP display component inside each player card, replacing or augmenting existing stats.**

Per CONTEXT.md format: compact icon-only format like `üè†2 üè∞1 üõ§Ô∏è2`

Add this section between player nickname and card count:

```tsx
{
  /* VP Breakdown - inline compact format */
}
<Group gap={4} justify="center">
  {/* Settlements */}
  <Tooltip
    label={`${settlementCount} settlement${settlementCount !== 1 ? 's' : ''} (1 VP each)`}
  >
    <Text size="sm" fw={500}>
      üè†{settlementCount}
    </Text>
  </Tooltip>

  {/* Cities */}
  <Tooltip
    label={`${cityCount} ${cityCount !== 1 ? 'cities' : 'city'} (2 VP each)`}
  >
    <Text size="sm" fw={500}>
      üè∞{cityCount}
    </Text>
  </Tooltip>

  {/* Longest Road (only show if player has it) */}
  {hasLongestRoad && (
    <Tooltip label="Longest Road (2 VP)">
      <Text size="sm" fw={500}>
        üõ§Ô∏è2
      </Text>
    </Tooltip>
  )}

  {/* Largest Army (only show if player has it) */}
  {hasLargestArmy && (
    <Tooltip label="Largest Army (2 VP)">
      <Text size="sm" fw={500}>
        ‚öîÔ∏è2
      </Text>
    </Tooltip>
  )}
</Group>;

{
  /* Total Public VP */
}
<Badge size="md" color="yellow" variant="filled" radius="sm">
  {publicVP.total} VP
</Badge>;
```

Calculate values using existing state from the component:

```typescript
const playerSettlements = settlements.filter((s) => s.playerId === player.id);
const settlementCount = playerSettlements.filter((s) => !s.isCity).length;
const cityCount = playerSettlements.filter((s) => s.isCity).length;
const publicVP =
  settlementCount +
  cityCount * 2 +
  (hasLongestRoad ? 2 : 0) +
  (hasLargestArmy ? 2 : 0);
```

Remove the separate "Longest" and "Largest" badges if they're now redundant with the VP icons.

**Important:** Only show public VP (no VP cards visible until game ends).
</action>
<verify>npm run build:web && npm run typecheck</verify>
<done>GamePlayerList shows inline VP breakdown with icons, total VP badge displayed</done>
</task>

</tasks>

<verification>
- [ ] npm run build:web succeeds
- [ ] npm run typecheck succeeds
- [ ] VP breakdown visible for all players in GamePlayerList
- [ ] Icons show settlements, cities, longest road, largest army
- [ ] Total VP badge shows sum of visible VP
- [ ] No VP card counts shown (hidden from opponents)
</verification>

<success_criteria>

- Public VP visible inline in player list
- Compact icon format matches CONTEXT.md specification
- Hidden VP cards not displayed
- Total VP calculated correctly from public sources
  </success_criteria>

<output>
After completion, create `.planning/phases/11-victory/11-03-SUMMARY.md`
</output>
