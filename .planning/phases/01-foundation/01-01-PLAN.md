---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - libs/shared/src/index.ts
  - libs/shared/src/schemas/room.ts
  - libs/shared/src/schemas/player.ts
  - libs/shared/src/schemas/messages.ts
  - libs/shared/src/constants/index.ts
autonomous: true

must_haves:
  truths:
    - "Backend can validate room data using Zod schemas"
    - "Frontend can import shared types via @catan/shared"
    - "WebSocket messages have type-safe contracts"
  artifacts:
    - path: "libs/shared/src/schemas/room.ts"
      provides: "Room schema with player limits"
      exports: ["RoomSchema", "Room"]
    - path: "libs/shared/src/schemas/player.ts"
      provides: "Player schema with nickname validation"
      exports: ["PlayerSchema", "Player"]
    - path: "libs/shared/src/schemas/messages.ts"
      provides: "WebSocket message protocol"
      exports: ["WebSocketMessageSchema", "WebSocketMessage"]
    - path: "libs/shared/src/constants/index.ts"
      provides: "Shared constants (colors, limits)"
      exports: ["PLAYER_COLORS", "MAX_PLAYERS", "MIN_PLAYERS"]
  key_links:
    - from: "apps/api/src"
      to: "@catan/shared"
      via: "import statement"
      pattern: "from ['\"]@catan/shared['\"]"
    - from: "apps/web/src"
      to: "@catan/shared"
      via: "import statement"
      pattern: "from ['\"]@catan/shared['\"]"
---

<objective>
Create shared type library with Zod schemas for type-safe contracts between frontend and backend.

Purpose: Establishes single source of truth for data structures, WebSocket messages, and validation rules. Both apps will import from `@catan/shared` to ensure type safety and runtime validation.

Output: Functioning shared library with room/player schemas, WebSocket message protocol, and shared constants.
</objective>

<execution_context>
@./.github/get-shit-done/workflows/execute-plan.md
@./.github/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/codebase/STACK.md
</context>

<tasks>

<task type="auto">
  <name>Create Zod schemas for room, player, and WebSocket messages</name>
  <files>
    libs/shared/src/schemas/room.ts
    libs/shared/src/schemas/player.ts
    libs/shared/src/schemas/messages.ts
  </files>
  <action>
Create three schema files following the patterns from RESEARCH.md:

**libs/shared/src/schemas/player.ts:**
- PlayerSchema with id (string), nickname (string, .trim().min(2).max(30)), color (enum: red/blue/white/orange), ready (boolean)
- Export schema and inferred type: `export type Player = z.infer<typeof PlayerSchema>;`

**libs/shared/src/schemas/room.ts:**
- RoomSchema with id (string.length(6).regex(/^[0-9A-Z]{6}$/)), players (array of PlayerSchema, min 1, max 4), createdAt (date)
- Export schema and inferred type

**libs/shared/src/schemas/messages.ts:**
- Create discriminated union with z.discriminatedUnion('type', [...])
- Message types:
  - join_room: { type: literal('join_room'), roomId: string.length(6), nickname: string.trim().min(2).max(30) }
  - create_room: { type: literal('create_room'), nickname: string.trim().min(2).max(30) }
  - room_created: { type: literal('room_created'), roomId: string, player: PlayerSchema }
  - player_joined: { type: literal('player_joined'), player: PlayerSchema }
  - player_left: { type: literal('player_left'), playerId: string }
  - player_ready: { type: literal('player_ready'), playerId: string, ready: boolean }
  - change_color: { type: literal('change_color'), playerId: string, color: enum(PLAYER_COLORS) }
  - color_changed: { type: literal('color_changed'), playerId: string, color: string }
  - toggle_ready: { type: literal('toggle_ready'), playerId: string }
  - game_starting: { type: literal('game_starting'), countdown: number }
  - room_state: { type: literal('room_state'), room: RoomSchema }
  - error: { type: literal('error'), message: enum(['Room not found', 'Room is full', 'Nickname taken', 'Invalid room ID', 'Color already taken']) }
- Export WebSocketMessageSchema and individual message type schemas
- Export all inferred types

Follow RESEARCH.md pattern: schemas + type inference, no manual type definitions.
  </action>
  <verify>
Run `npx nx build shared` (if buildable) or `npx tsc --noEmit -p libs/shared/tsconfig.json` to verify TypeScript compilation.
Check that schemas export both Zod schemas and inferred types.
  </verify>
  <done>
All three schema files exist with proper Zod schemas, discriminated union for messages works, TypeScript compiles without errors, exports are correct.
  </done>
</task>

<task type="auto">
  <name>Create shared constants and configure barrel exports</name>
  <files>
    libs/shared/src/constants/index.ts
    libs/shared/src/index.ts
  </files>
  <action>
**libs/shared/src/constants/index.ts:**
```typescript
export const PLAYER_COLORS = ['red', 'blue', 'white', 'orange'] as const;
export const MAX_PLAYERS = 4;
export const MIN_PLAYERS = 3;
export const GRACE_PERIOD_MS = 3 * 60 * 1000; // 3 minutes
export const ROOM_ID_LENGTH = 6;
export const ROOM_ID_ALPHABET = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';
```

**libs/shared/src/index.ts (barrel export):**
```typescript
export * from './schemas/room';
export * from './schemas/player';
export * from './schemas/messages';
export * from './constants';
```

Verify tsconfig.base.json has correct path mapping for @catan/shared pointing to libs/shared/src/index.ts.
  </action>
  <verify>
Run `npx tsc --noEmit -p tsconfig.base.json` to verify path mapping works.
Try importing in a test file: `import { RoomSchema, PLAYER_COLORS } from '@catan/shared';` and verify no TS errors.
  </verify>
  <done>
Constants file exists with all values from CONTEXT.md, barrel export re-exports all schemas/types/constants, path mapping works for @catan/shared imports.
  </done>
</task>

</tasks>

<verification>
1. All schema files compile without TypeScript errors
2. Barrel export (index.ts) re-exports all schemas, types, and constants
3. Can import via `@catan/shared` alias from both apps/api and apps/web
4. Zod discriminated union for messages validates correctly
5. PlayerSchema enforces nickname min/max and trim
6. RoomSchema enforces 1-4 player limit and 6-char room ID format
</verification>

<success_criteria>
- [ ] libs/shared/src/schemas/room.ts exists with RoomSchema
- [ ] libs/shared/src/schemas/player.ts exists with PlayerSchema
- [ ] libs/shared/src/schemas/messages.ts exists with WebSocketMessageSchema (discriminated union)
- [ ] libs/shared/src/constants/index.ts exists with colors, limits, grace period
- [ ] libs/shared/src/index.ts barrel export works
- [ ] `npx tsc --noEmit` passes for shared library
- [ ] @catan/shared import path resolves in tsconfig.base.json
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md` documenting schemas, types, and exports.
</output>
