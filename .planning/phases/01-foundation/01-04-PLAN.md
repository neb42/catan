---
phase: 01-foundation
plan: 04
type: execute
wave: 4
depends_on: ["01-01", "01-02", "01-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can create room and receive shareable room ID"
    - "User can join room with room ID and nickname"
    - "User sees other players join in real-time (< 500ms)"
    - "Invalid operations show clear error messages"
    - "WebSocket reconnects after network interruption"
  artifacts: []
  key_links: []
---

<objective>
Verify end-to-end room creation, joining, and real-time synchronization work correctly.

Purpose: Validate that all Phase 1 requirements (LOBBY-01, LOBBY-02, LOBBY-03, SYNC-01) are met before moving to Phase 2.

Output: Confirmed working multiplayer lobby infrastructure.
</objective>

<execution_context>
@./.github/get-shit-done/workflows/execute-plan.md
@./.github/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete multiplayer lobby infrastructure:
- Shared type library with Zod schemas (@catan/shared)
- WebSocket server with room management (ws://localhost:3333/ws)
- Lobby UI with create/join room forms and real-time player list
  </what-built>
  <how-to-verify>
**Setup:**
1. Open two browser windows/tabs side-by-side
2. Run `npx nx serve api` in one terminal
3. Run `npx nx serve web` in another terminal
4. Wait for both to start (web at http://localhost:5173, API at http://localhost:3333)

**Test Case 1: Create Room (LOBBY-01)**
1. In Window 1: Enter nickname "Alice", click "Create Room"
2. Verify: Room ID displayed (6 uppercase alphanumeric chars, e.g., "A1B2C3")
3. Verify: "Copy room ID" button appears
4. Click copy button, paste in notepad → Verify ID copied correctly
5. Verify: Alice appears in player list

**Test Case 2: Join Room (LOBBY-02, LOBBY-03)**
1. In Window 2: Enter Room ID from Window 1, nickname "Bob", click "Join Room"
2. Verify: Window 2 shows player list with Alice and Bob
3. Verify: Window 1 updates to show Bob (< 500ms) — real-time sync (SYNC-01)

**Test Case 3: Multiple Players**
1. Open Windows 3 and 4, join same room with nicknames "Carol" and "Dave"
2. Verify: All 4 windows show all 4 players in sync

**Test Case 4: Error Handling - Room Full**
1. Open Window 5, try to join same room with nickname "Eve"
2. Verify: Error message "Room is full" displayed

**Test Case 5: Error Handling - Duplicate Nickname**
1. Open new window, try to join with nickname "Alice" (already taken)
2. Verify: Error message "Nickname taken" displayed

**Test Case 6: Error Handling - Invalid Room ID**
1. Open new window, enter room ID "XXXXXX" (non-existent), nickname "Frank"
2. Verify: Error message "Room not found" displayed

**Test Case 7: Nickname Validation**
1. Try to create room with nickname "A" (too short)
2. Verify: Button disabled or error shown
3. Try with "X" repeated 31 times (too long)
4. Verify: Button disabled or error shown
5. Try with "  Bob  " (whitespace)
6. Verify: Nickname trimmed to "Bob"

**Test Case 8: Player Leave**
1. In Window 2 (Bob), close tab or browser
2. Verify: Other windows show Bob removed from player list within a few seconds

**Test Case 9: Grace Period Cleanup**
1. Create new room, close all browser windows
2. Wait 3 minutes
3. Try to join the room using saved room ID
4. Verify: Error "Room not found" (room expired)

**Test Case 10: WebSocket Reconnection**
1. Create room with 2 players in separate windows
2. Stop API server (Ctrl+C in terminal)
3. Verify: Both windows show "Reconnecting..." or similar indicator
4. Restart API server (`npx nx serve api`)
5. Verify: Reconnection indicator disappears within ~30 seconds
6. Note: Room lost after restart is expected (no persistence)

**Success Criteria:**
- All test cases pass
- Real-time updates < 500ms
- Error messages clear and specific
- No console errors in browser DevTools
- No uncaught exceptions in API server logs
  </how-to-verify>
  <resume-signal>
Type "approved" if all tests pass, or describe any failing test cases.
  </resume-signal>
</task>

</tasks>

<verification>
All Phase 1 requirements verified:
- ✅ LOBBY-01: User can create room and receive shareable room ID
- ✅ LOBBY-02: User can join room by entering room ID
- ✅ LOBBY-03: User can set nickname when joining
- ✅ SYNC-01: Real-time WebSocket state updates (< 500ms)
- ✅ Shared types library working
- ✅ WebSocket infrastructure stable
</verification>

<success_criteria>
- [ ] Test Case 1-10 all pass
- [ ] No breaking errors in browser or server logs
- [ ] Real-time sync latency < 500ms
- [ ] Error messages match CONTEXT.md specifications
- [ ] Grace period cleanup works as specified (3 minutes)
- [ ] WebSocket reconnection functions correctly
</success_criteria>

<output>
After human approval, create `.planning/phases/01-foundation/01-04-SUMMARY.md` documenting verification results and any issues encountered.
</output>
