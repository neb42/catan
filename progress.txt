# Progress Log

## Learnings
(Patterns discovered during implementation)
- Nx 22.x uses `@nx/js` plugin with TypeScript support built-in
- Use `workspaceLayout` in nx.json to configure apps/libs directories
- Typecheck with `npx tsc --noEmit` at root level
- *.tsbuildinfo files should be in .gitignore

---

## Iteration 1 - US-001: Initialize Nx Workspace
- What was implemented:
  - Created Nx workspace using create-nx-workspace with ts preset
  - Configured apps/ and libs/ directory structure
  - Added SUMMARY.md at workspace root
  - Updated nx.json with workspaceLayout
  - Fixed package.json workspaces and name
- Files changed:
  - nx.json (added workspaceLayout)
  - package.json (fixed name and workspaces)
  - tsconfig.base.json (fixed customConditions)
  - SUMMARY.md (new)
  - .gitignore (added *.tsbuildinfo)
- Learnings for future iterations:
  - create-nx-workspace cannot be run in existing dir, create then copy
  - The ts preset creates "packages/" dir - must manually change to apps/libs
  - All acceptance criteria should be verified before marking complete
---

## Iteration 2 - US-002: Create Express API Application
- What was implemented:
  - Verified apps/api/ directory structure already existed from previous setup
  - apps/api/src/main.ts entry point with Express server and PORT config
  - project.json with build (using @nx/js:swc) and serve targets
  - tsconfig.json and tsconfig.app.json properly configured
  - SUMMARY.md already present explaining the application
- Files changed:
  - PRD.md (marked US-002 as complete)
  - progress.txt (added this entry)
- Learnings for future iterations:
  - The api app was scaffolded in a previous iteration - check existing state first
  - Typecheck for api app: `npx tsc --noEmit -p apps/api/tsconfig.app.json`
  - Express 5.x is being used (check package.json)
  - @nx/js:swc executor is used for building, @nx/js:node for serving
  - Need @swc/cli package for SWC build executor to work
  - .swcrc config file required in apps/api/ directory
---

## Iteration 3 - US-003: Set Up Environment Configuration
- What was implemented:
  - Verified dotenv was already installed (and added it to ensure it's there)
  - .env.example already exists with PORT, NODE_ENV, WS_PORT documented
  - .env already added to .gitignore (with .env.local patterns)
  - apps/api/src/config/index.ts already exists with typed AppConfig
  - Config loaded and validated with proper error handling
  - SUMMARY.md in config/ directory with usage documentation
- Files changed:
  - PRD.md (marked US-003 as complete)
  - progress.txt (added this entry)
  - package.json, package-lock.json (ensured dotenv dependency)
- Learnings for future iterations:
  - Previous iterations may have implemented parts of future tasks
  - Always verify existing state before implementing
  - dotenv.config() should use path.resolve for reliable .env loading
  - Config validates NODE_ENV against allowed values
---

## Iteration 4 - US-004: Create Core Directory Structure
- What was implemented:
  - Created all required directories under apps/api/src/:
    - features/ (empty, for future feature modules)
    - middleware/ (for Express middleware)
    - routes/ (for route mounting logic)
    - utils/ (for utility functions)
    - types/ (for shared type definitions)
    - constants/ (for application constants)
    - models/ (for data models)
    - services/ (for business logic services)
  - Created SUMMARY.md files for each directory explaining purpose and guidelines
- Files changed:
  - apps/api/src/features/SUMMARY.md (new)
  - apps/api/src/middleware/SUMMARY.md (new)
  - apps/api/src/routes/SUMMARY.md (new)
  - apps/api/src/utils/SUMMARY.md (new)
  - apps/api/src/types/SUMMARY.md (new)
  - apps/api/src/constants/SUMMARY.md (new)
  - apps/api/src/models/SUMMARY.md (new)
  - apps/api/src/services/SUMMARY.md (new)
  - PRD.md (marked US-004 as complete)
  - progress.txt (added this entry)
- Learnings for future iterations:
  - SUMMARY.md files serve as AI context for understanding directory purposes
  - Empty directories with only SUMMARY.md still pass typecheck
  - Feature-based architecture groups related code together
---

## Iteration 5 - US-005: Set Up Express App Structure
- What was implemented:
  - Created apps/api/src/app.ts with Express app factory function (createApp)
  - Installed cors package and @types/cors for CORS middleware
  - Configured JSON body parsing with express.json() and express.urlencoded()
  - Configured CORS middleware with cors()
  - Created health check route at GET /health returning { status: 'ok' }
  - Created apps/api/src/routes/index.ts with main router and route mounting pattern
  - Created apps/api/src/middleware/errorHandler.ts for centralized error handling
  - Created apps/api/src/middleware/requestLogger.ts for request logging with duration
  - Updated main.ts to import createApp from app.ts
  - Updated SUMMARY.md files in middleware and routes directories
- Files changed:
  - apps/api/src/app.ts (new)
  - apps/api/src/routes/index.ts (new)
  - apps/api/src/middleware/errorHandler.ts (new)
  - apps/api/src/middleware/requestLogger.ts (new)
  - apps/api/src/main.ts (updated to use createApp)
  - apps/api/src/middleware/SUMMARY.md (updated)
  - apps/api/src/routes/SUMMARY.md (updated)
  - package.json (added cors dependency)
  - PRD.md (marked US-005 as complete)
  - progress.txt (added this entry)
- Learnings for future iterations:
  - Express 5.x is used - middleware and error handlers work the same as v4
  - Use createApp factory function to separate app configuration from server start
  - Error handlers in Express need 4 arguments (err, req, res, next) to be recognized
  - Request logger attaches to res.on('finish') to get final status code and duration
---

## Iteration 6 - US-006: Add WebSocket Support
- What was implemented:
  - Installed `ws` package and `@types/ws` for WebSocket support
  - Created `apps/api/src/websocket/` directory
  - Created `apps/api/src/websocket/index.ts` with WebSocket server initialization
  - WebSocket server attaches to HTTP server using upgrade pattern
  - Implemented connection/disconnection logging with unique client IDs
  - Created SUMMARY.md documenting WebSocket setup and usage
  - Updated main.ts to create HTTP server and attach WebSocket
- Files changed:
  - apps/api/src/websocket/index.ts (new)
  - apps/api/src/websocket/SUMMARY.md (new)
  - apps/api/src/main.ts (updated to use createServer and initializeWebSocket)
  - package.json (added ws dependency)
  - package-lock.json (updated)
  - PRD.md (marked US-006 as complete)
  - progress.txt (added this entry)
- Learnings for future iterations:
  - Use `createServer(app)` from 'http' to get httpServer for WebSocket attachment
  - WebSocket upgrade pattern allows sharing port with HTTP server
  - The `ws` module's WebSocket type works with `server.clients` for tracking connections
  - Connection handlers should track IDs separately from the WebSocket object
---

## Iteration 7 - US-007: Add Base Type Definitions
- What was implemented:
  - Created apps/api/src/types/index.ts with shared type exports
  - Re-exported AppConfig from config/ module (single source of truth)
  - Defined ApiResponse<T> generic type for standardized API responses
  - Defined WebSocketMessage<T> generic type for WebSocket communication
  - Updated SUMMARY.md with documentation on available types and usage guidelines
- Files changed:
  - apps/api/src/types/index.ts (new)
  - apps/api/src/types/SUMMARY.md (updated)
  - PRD.md (marked US-007 as complete)
  - progress.txt (added this entry)
- Learnings for future iterations:
  - Use `export type { X }` instead of `export { X }` when isolatedModules is enabled
  - Re-export types from canonical source rather than duplicating definitions
  - Generic types with `T = unknown` provide flexibility while maintaining type safety
---

## Iteration 8 - US-008: Add Utility and Constants Foundations
- What was implemented:
  - Created apps/api/src/utils/index.ts with placeholder `noop` function
  - Created apps/api/src/constants/httpStatus.ts with HTTP status codes:
    - Individual constants (HTTP_OK, HTTP_NOT_FOUND, etc.)
    - Grouped HTTP_STATUS object for convenient access
    - HttpStatusCode type for type-safe status codes
  - Created apps/api/src/constants/index.ts with:
    - Re-exports from httpStatus.ts
    - APP_NAME, API_VERSION, API_PREFIX constants
    - DEFAULT_PORT, DEFAULT_WS_PORT, DEFAULT_NODE_ENV defaults
    - Timing constants (ONE_SECOND, ONE_MINUTE, ONE_HOUR)
    - ERROR_MESSAGES object with common error strings
  - Updated SUMMARY.md files with documentation on available exports
- Files changed:
  - apps/api/src/utils/index.ts (new)
  - apps/api/src/constants/httpStatus.ts (new)
  - apps/api/src/constants/index.ts (new)
  - apps/api/src/utils/SUMMARY.md (updated)
  - apps/api/src/constants/SUMMARY.md (updated)
  - PRD.md (marked US-008 as complete)
  - progress.txt (added this entry)
- Learnings for future iterations:
  - Use `as const` for constant objects to get literal types
  - Organize constants into separate files by category then re-export from index
  - Placeholder utility functions (noop) help establish the export pattern
---
